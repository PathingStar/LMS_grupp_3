@page "/courses"
@using LMS.Blazor.Client.Services
@using LMS.Shared.DTOs.EntityDto
@using Microsoft.AspNetCore.Authorization
@rendermode InteractiveWebAssembly
@attribute [Authorize(Roles = "Teacher")]

<h3>CourseList</h3>


@if (Loading)
{
	<p>Loading courses...</p>
}
else
{
	@if (Courses != null)
	{
		@foreach (var course in Courses)
		{
			<CourseComponent Course=course />
		}
	}
	else
	{
		<p>Loading courses...</p>
	}

}
<CourseAddComponent OnCourseAdded="HandleCourseAdded" />

@code
{
	public bool Loading { get; set; } = true;

	[Inject]
	private IApiService myApi { get; set; } = default!;

	[Inject]
	private AuthenticationStateProvider Auth { get; set; } = default!;

    // Changed from IEnumerable to List to allow adding new courses
	private List<CourseDto>? Courses { get; set; }

	protected override async Task OnInitializedAsync()
	{
		await LoadCourse();
		Loading = false;
	}

	private async Task LoadCourse()
	{

		var response = await myApi.CallApiGetAsync<IEnumerable<CourseDto>>("courses");
		Courses = response?.ToList();

	}

    // New method to handle the event when a course is added CourseList.razor is parent to CourseAddComponent.razor
	private void HandleCourseAdded(CourseDto newCourse)
	{
        Courses.Add(newCourse);
        StateHasChanged();
	}
}
